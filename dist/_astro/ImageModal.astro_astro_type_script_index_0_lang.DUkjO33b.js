function S(){return new Promise((e,g)=>{if(window.pdfjsLib){e();return}const i=document.createElement("script");i.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",i.onload=()=>{window.pdfjsLib?(window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",console.log("PDF.js loaded successfully for modal"),e()):g(new Error("Failed to load PDF.js"))},i.onerror=()=>g(new Error("Failed to load PDF.js script")),document.head.appendChild(i)})}window.loadPDFInCanvas=async function(e){const g=e.getAttribute("data-pdf-url"),i=parseInt(e.getAttribute("data-page-number")||"1"),h=parseInt(e.getAttribute("data-width")||"400"),v=parseInt(e.getAttribute("data-height")||"600"),c=document.getElementById(`loading-${e.id}`),C=document.getElementById(`error-${e.id}`);if(!g){console.error("No PDF URL provided");return}try{if(window.pdfjsLib||(console.log("PDF.js not loaded, loading now..."),await S()),!window.pdfjsLib)throw new Error("PDF.js failed to load");const l=decodeURIComponent(g);console.log("Loading PDF:",l,"Page:",i);const u=await(await window.pdfjsLib.getDocument(l).promise).getPage(i),r=u.getViewport({scale:1}),o=h/r.width,L=v/r.height,b=Math.min(o,L),p=u.getViewport({scale:b});e.width=p.width,e.height=p.height,e.style.width="100%",e.style.height="100%",e.style.maxWidth="none",e.style.maxHeight="none",e.style.objectFit="contain";const y=e.getContext("2d");if(!y)throw new Error("Cannot get 2D context from canvas");const x={canvasContext:y,viewport:p};await u.render(x).promise,c&&c.classList.add("hidden"),e.style.display="block",console.log("PDF loaded successfully")}catch(l){console.error("Error loading PDF:",l),c&&c.classList.add("hidden"),C&&(C.classList.remove("hidden"),C.innerHTML="<p>Erro ao carregar PDF: "+l.message+"</p>")}};document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("image-modal"),g=document.getElementById("close-modal"),i=document.getElementById("prev-candidate"),h=document.getElementById("next-candidate"),v=document.getElementById("toggle-view"),c=document.getElementById("toggle-icon"),C=document.getElementById("expand-pdf"),l=document.getElementById("fullscreen-pdf-modal"),D=document.getElementById("close-fullscreen-pdf"),u=document.getElementById("fullscreen-pdf-content"),r=document.getElementById("modal-image"),o=document.getElementById("modal-pdf-container"),L=document.getElementById("modal-title"),b=document.getElementById("modal-role"),p=document.getElementById("modal-stats"),y=document.getElementById("modal-description");window.openCandidateModal=function(n,t,a,d,w="",f=!1,P=1){if(e&&r&&o&&L&&b&&p&&y){(!window.allCandidates||window.allCandidates.length===0)&&M();const H=window.allCandidates.findIndex(s=>s.name===t);if(H!==-1)window.currentCandidateIndex=H;else{const s={imageSrc:n,name:t,role:a,stats:d,description:w,isPdf:f,pdfPage:P};window.allCandidates.push(s),window.currentCandidateIndex=window.allCandidates.length-1}if(A(),window.currentViewMode=f?"cv":"profile",B(),L.textContent=t,b.textContent=a,y.textContent=w,f){r.classList.add("hidden"),o.classList.remove("hidden"),o.innerHTML="";const s=document.createElement("canvas");s.id=`modal-pdf-canvas-${Math.random().toString(36).substr(2,9)}`,s.setAttribute("data-pdf-url",n),s.setAttribute("data-page-number",P.toString()),s.setAttribute("data-width","1200"),s.setAttribute("data-height","1600"),s.className="pdf-canvas",o.appendChild(s);const m=document.createElement("div");m.id=`loading-${s.id}`,m.className="pdf-loading",m.innerHTML=`
            <div class="loading-spinner"></div>
            <p>Carregando PDF...</p>
          `,o.appendChild(m);const I=document.createElement("div");I.id=`error-${s.id}`,I.className="pdf-error hidden",I.innerHTML="<p>Erro ao carregar PDF</p>",o.appendChild(I),window.loadPDFInCanvas?window.loadPDFInCanvas(s).catch($=>{console.error("Failed to load PDF in modal:",$),I.classList.remove("hidden"),m.classList.add("hidden")}):(console.error("loadPDFInCanvas function not available"),I.classList.remove("hidden"),m.classList.add("hidden"))}else r.classList.remove("hidden"),o.classList.add("hidden"),r.src=n,r.alt=t;if(d&&d.length>0){const s=d.map(m=>`<div class="stat-item">
              <span class="stat-value">${m.value}</span>
              <span class="stat-label">${m.label}</span>
            </div>`).join("");p.innerHTML=`<div class="stats-grid">${s}</div>`}else p.innerHTML="";e.classList.remove("hidden"),document.body.style.overflow="hidden"}};function x(){e&&(e.classList.add("hidden"),document.body.style.overflow="")}g?.addEventListener("click",x),e?.addEventListener("click",function(n){n.target===e&&x()}),l?.addEventListener("click",function(n){n.target===l&&E()});function A(){if(!window.allCandidates||window.currentCandidateIndex===void 0)return;const n=window.allCandidates.length,t=window.currentCandidateIndex;i&&(i.style.display=n>1?"flex":"none",i.disabled=t===0),h&&(h.style.display=n>1?"flex":"none",h.disabled=t===n-1)}function F(n){if(!window.allCandidates||window.currentCandidateIndex===void 0)return;const t=window.allCandidates.length;let a=window.currentCandidateIndex;if(n==="prev"&&a>0)a--;else if(n==="next"&&a<t-1)a++;else return;const d=window.allCandidates[a];if(d)if(window.currentCandidateIndex=a,A(),L.textContent=d.name,b.textContent=d.role,y.textContent=d.description,j(),d.stats&&d.stats.length>0){const w=d.stats.map(f=>`<div class="stat-item">
              <span class="stat-value">${f.value}</span>
              <span class="stat-label">${f.label}</span>
            </div>`).join("");p.innerHTML=`<div class="stats-grid">${w}</div>`}else p.innerHTML=""}function B(){c&&(window.currentViewMode==="cv"?(c.innerHTML=`
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
          <circle cx="12" cy="7" r="4"></circle>
        `,v?.setAttribute("aria-label","Switch to profile view")):(c.innerHTML=`
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14,2 14,8 20,8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10,9 9,9 8,9"></polyline>
        `,v?.setAttribute("aria-label","Switch to CV view")))}function j(){if(!window.allCandidates||window.currentCandidateIndex===void 0)return;const n=window.allCandidates[window.currentCandidateIndex];if(n)if(window.currentViewMode==="cv"){r.classList.add("hidden"),o.classList.remove("hidden"),o.innerHTML="";const t=document.createElement("canvas");t.id=`modal-pdf-canvas-${Math.random().toString(36).substr(2,9)}`,t.setAttribute("data-pdf-url",n.imageSrc),t.setAttribute("data-page-number",n.pdfPage.toString()),t.setAttribute("data-width","1200"),t.setAttribute("data-height","1600"),t.className="pdf-canvas",o.appendChild(t);const a=document.createElement("div");a.id=`loading-${t.id}`,a.className="pdf-loading",a.innerHTML=`
          <div class="loading-spinner"></div>
          <p>Carregando PDF...</p>
        `,o.appendChild(a);const d=document.createElement("div");d.id=`error-${t.id}`,d.className="pdf-error hidden",d.innerHTML="<p>Erro ao carregar PDF</p>",o.appendChild(d),window.loadPDFInCanvas&&window.loadPDFInCanvas(t).catch(w=>{console.error("Failed to load PDF in modal:",w),d.classList.remove("hidden"),a.classList.add("hidden")})}else{r.classList.remove("hidden"),o.classList.add("hidden");const t=document.querySelectorAll(".clickable-image");let a=n.imageSrc;t.forEach(d=>{if(d.getAttribute("data-name")===n.name){const f=d.getAttribute("data-profile-src");if(f)a=f;else{const P=d.getAttribute("data-image-src");P&&(a=P)}}}),r.src=a,r.alt=n.name}}function T(){window.currentViewMode==="cv"?window.currentViewMode="profile":window.currentViewMode="cv",B(),j()}function k(){if(!window.allCandidates||window.currentCandidateIndex===void 0)return;const n=window.allCandidates[window.currentCandidateIndex];if(!n)return;u.innerHTML="";const t=document.createElement("canvas");t.id=`fullscreen-pdf-canvas-${Math.random().toString(36).substr(2,9)}`,t.setAttribute("data-pdf-url",n.imageSrc),t.setAttribute("data-page-number",n.pdfPage.toString()),t.setAttribute("data-width","1920"),t.setAttribute("data-height","1080"),t.className="fullscreen-pdf-canvas",u.appendChild(t);const a=document.createElement("div");a.id=`loading-${t.id}`,a.className="fullscreen-pdf-loading",a.innerHTML=`
        <div class="loading-spinner"></div>
        <p>Carregando PDF...</p>
      `,u.appendChild(a);const d=document.createElement("div");d.id=`error-${t.id}`,d.className="fullscreen-pdf-error hidden",d.innerHTML="<p>Erro ao carregar PDF</p>",u.appendChild(d),l.classList.remove("hidden"),document.body.style.overflow="hidden",window.loadPDFInCanvas&&window.loadPDFInCanvas(t).catch(w=>{console.error("Failed to load PDF in fullscreen:",w),d.classList.remove("hidden"),a.classList.add("hidden")})}function E(){l.classList.add("hidden"),document.body.style.overflow=""}i?.addEventListener("click",()=>F("prev")),h?.addEventListener("click",()=>F("next")),v?.addEventListener("click",T),C?.addEventListener("click",k),D?.addEventListener("click",E),document.addEventListener("keydown",function(n){n.key==="Escape"?l?.classList.contains("hidden")?e?.classList.contains("hidden")||x():E():!e?.classList.contains("hidden")&&!l?.classList.contains("hidden")&&(n.key==="ArrowLeft"?F("prev"):n.key==="ArrowRight"&&F("next"))})});function V(){const e=[];return document.querySelectorAll(".clickable-image").forEach(i=>{const h=i.getAttribute("data-image-src"),v=i.getAttribute("data-name"),c=i.getAttribute("data-role"),C=i.getAttribute("data-description"),l=i.getAttribute("data-stats");if(h&&v&&c){let D=[];try{D=l?JSON.parse(l):[]}catch(b){console.warn("Failed to parse stats data:",b)}const u=i.getAttribute("data-pdf-page"),r=u?parseInt(u):1,L=i.getAttribute("data-curriculum-pdf")||"/candidatura Ã  JRP projeto.pdf";e.push({imageSrc:L,name:v,role:c,stats:D,description:C||"",isPdf:!0,pdfPage:r})}}),e}function M(){if(window.allCandidates&&window.allCandidates.length>0)return;const e=V();window.allCandidates=e,window.currentCandidateIndex=0,console.log(`Initialized ${e.length} candidates for navigation`)}typeof window<"u"&&!window.modalPDFInitialized&&(window.modalPDFInitialized=!0,S().catch(e=>{console.warn("Failed to pre-load PDF.js:",e)}));typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",M):M());
