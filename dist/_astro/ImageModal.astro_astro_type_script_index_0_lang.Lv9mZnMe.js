function b(){return new Promise((e,s)=>{if(window.pdfjsLib){e();return}const d=document.createElement("script");d.src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js",d.onload=()=>{window.pdfjsLib?(window.pdfjsLib.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js",console.log("PDF.js loaded successfully for modal"),e()):s(new Error("Failed to load PDF.js"))},d.onerror=()=>s(new Error("Failed to load PDF.js script")),document.head.appendChild(d)})}window.loadPDFInCanvas=async function(e){const s=e.getAttribute("data-pdf-url"),d=parseInt(e.getAttribute("data-page-number")||"1"),n=parseInt(e.getAttribute("data-width")||"400"),g=parseInt(e.getAttribute("data-height")||"600"),r=document.getElementById(`loading-${e.id}`),l=document.getElementById(`error-${e.id}`);if(!s){console.error("No PDF URL provided");return}try{if(window.pdfjsLib||(console.log("PDF.js not loaded, loading now..."),await b()),!window.pdfjsLib)throw new Error("PDF.js failed to load");const a=decodeURIComponent(s);console.log("Loading PDF:",a,"Page:",d);const o=await(await window.pdfjsLib.getDocument(a).promise).getPage(d),p=o.getViewport({scale:1}),h=n/p.width,f=g/p.height,L=Math.min(h,f),c=o.getViewport({scale:L});e.width=c.width,e.height=c.height,e.style.width=c.width+"px",e.style.height=c.height+"px";const u=e.getContext("2d");if(!u)throw new Error("Cannot get 2D context from canvas");const t={canvasContext:u,viewport:c};await o.render(t).promise,r&&r.classList.add("hidden"),e.style.display="block",console.log("PDF loaded successfully")}catch(a){console.error("Error loading PDF:",a),r&&r.classList.add("hidden"),l&&(l.classList.remove("hidden"),l.innerHTML="<p>Erro ao carregar PDF: "+a.message+"</p>")}};document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("image-modal"),s=document.getElementById("close-modal"),d=document.getElementById("modal-image"),n=document.getElementById("modal-pdf-container"),g=document.getElementById("modal-title"),r=document.getElementById("modal-role"),l=document.getElementById("modal-stats"),a=document.getElementById("modal-description");window.openCandidateModal=function(o,p,h,f,L="",c=!1,u=1){if(e&&d&&n&&g&&r&&l&&a){if(g.textContent=p,r.textContent=h,a.textContent=L,c){d.classList.add("hidden"),n.classList.remove("hidden"),n.innerHTML="";const t=document.createElement("canvas");t.id=`modal-pdf-canvas-${Math.random().toString(36).substr(2,9)}`,t.setAttribute("data-pdf-url",o),t.setAttribute("data-page-number",u.toString()),t.setAttribute("data-width","400"),t.setAttribute("data-height","600"),t.className="pdf-canvas",n.appendChild(t);const i=document.createElement("div");i.id=`loading-${t.id}`,i.className="pdf-loading",i.innerHTML=`
            <div class="loading-spinner"></div>
            <p>Carregando PDF...</p>
          `,n.appendChild(i);const m=document.createElement("div");m.id=`error-${t.id}`,m.className="pdf-error hidden",m.innerHTML="<p>Erro ao carregar PDF</p>",n.appendChild(m),window.loadPDFInCanvas?window.loadPDFInCanvas(t).catch(D=>{console.error("Failed to load PDF in modal:",D),m.classList.remove("hidden"),i.classList.add("hidden")}):(console.error("loadPDFInCanvas function not available"),m.classList.remove("hidden"),i.classList.add("hidden"))}else d.classList.remove("hidden"),n.classList.add("hidden"),d.src=o,d.alt=p;if(f&&f.length>0){const t=f.map(i=>`<div class="stat-item">
              <span class="stat-value">${i.value}</span>
              <span class="stat-label">${i.label}</span>
            </div>`).join("");l.innerHTML=`<div class="stats-grid">${t}</div>`}else l.innerHTML="";e.classList.remove("hidden"),document.body.style.overflow="hidden"}};function w(){e&&(e.classList.add("hidden"),document.body.style.overflow="")}s?.addEventListener("click",w),e?.addEventListener("click",function(o){o.target===e&&w()}),document.addEventListener("keydown",function(o){o.key==="Escape"&&!e?.classList.contains("hidden")&&w()})});typeof window<"u"&&!window.modalPDFInitialized&&(window.modalPDFInitialized=!0,b().catch(e=>{console.warn("Failed to pre-load PDF.js:",e)}));
